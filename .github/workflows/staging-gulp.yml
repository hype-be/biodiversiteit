name: Biodiversiteit Gulp
on:
  workflow_dispatch:
    inputs:
      logLevel:
        description: 'Log level'
        required: true
        default: 'warning'
      tags:
        description: 'Test scenario tags'
  push:
    branches: [ dev ]
jobs:
  printInputs:
    runs-on: ubuntu-latest
    steps:
      - run: |
          echo "Log level: ${{ github.event.inputs.logLevel }}"
          echo "Tags: ${{ github.event.inputs.tags }}"
  build:
    runs-on: ubuntu-latest

    strategy:
      matrix:
        node-version: [12.x]

    steps:
      - uses: actions/checkout@v3

      - name: Use Node.js ${{ matrix.node-version }}
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}

      - name: Build
        run: |
          cd themes/custom/biodiv
          npm install
          gulp styles
          gulp js

    deploy:
      runs-on: ubuntu-latest
      needs: build
      steps:
        - uses: actions/checkout@v1
        - name: Install Node.js
        uses: actions/setup-node@v1
        with:
          node-version: '10.x'
          - name: Install npm dependencies
            run: npm install
          - name: Run build task
            run: npm run build --if-present
          - name: Deploy to Server
            uses: easingthemes/ssh-deploy@main
            env:
              SSH_PRIVATE_KEY: ${{ secrets.SERVER_SSH_KEY }}
              ARGS: "-rltgoDzvO --delete"
              SOURCE: "/"
              REMOTE_HOST: ${{ secrets.REMOTE_HOST }}
              REMOTE_USER: ${{ secrets.REMOTE_USER }}
              TARGET: ${{ secrets.REMOTE_TARGET }}
              EXCLUDE: "/themes/custom/biodiv/node_modules/"

